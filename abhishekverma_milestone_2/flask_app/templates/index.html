<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fire Weather Index Predictor</title>
<style>
/* --- CSS unchanged --- */
* {margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;overflow-x:hidden;}
.container{max-width:1400px;margin:0 auto;}
.header{text-align:center;color:white;margin-bottom:30px;animation:fadeInDown 0.8s ease-out;}
.header h1{font-size:3em;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;gap:15px;}
.header .logo-emoji{font-size:1.2em;animation:pulse 2s infinite;}
.main-content{display:grid;grid-template-columns:1fr 1fr;gap:30px;align-items:start;}
.input-panel{background:white;border-radius:20px;padding:40px;box-shadow:0 20px 60px rgba(0,0,0,0.3);animation:fadeInLeft 0.8s ease-out;max-height:90vh;overflow-y:auto;}
.input-panel h2{color:#333;margin-bottom:25px;font-size:1.5em;display:flex;align-items:center;gap:10px;}
.section-title{color:#555;font-weight:700;font-size:1.1em;margin-top:25px;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #667eea;}
.input-group{margin-bottom:18px;}
.input-group label{display:block;color:#555;font-weight:600;margin-bottom:8px;font-size:0.9em;}
.input-group small{display:block;color:#999;font-size:0.8em;margin-top:3px;}
.region-buttons{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.region-btn{padding:12px 15px;border:2px solid #ddd;background:white;border-radius:10px;cursor:pointer;font-size:0.95em;font-weight:600;color:#555;transition:all 0.3s ease;}
.region-btn:hover{border-color:#667eea;transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,0.2);}
.region-btn.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border-color:#667eea;box-shadow:0 10px 30px rgba(102,126,234,0.4);}
.date-inputs{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
select,input[type="number"]{width:100%;padding:10px 12px;border:2px solid #ddd;border-radius:8px;font-size:0.95em;background:white;color:#333;cursor:pointer;transition:all 0.3s ease;font-weight:500;}
select:hover,select:focus,input[type="number"]:hover,input[type="number"]:focus{border-color:#667eea;outline:none;box-shadow:0 0 0 3px rgba(102,126,234,0.1);}
.feature-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.predict-btn{width:100%;padding:16px;background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white;border:none;border-radius:10px;font-size:1.1em;font-weight:700;cursor:pointer;margin-top:25px;transition:all 0.3s ease;box-shadow:0 10px 30px rgba(245,87,108,0.3);}
.predict-btn:hover:not(:disabled){transform:translateY(-3px);box-shadow:0 15px 40px rgba(245,87,108,0.5);}
.predict-btn:disabled{opacity:0.6;cursor:not-allowed;}
.risk-panel{border-radius:20px;padding:40px;min-height:600px;box-shadow:0 20px 60px rgba(0,0,0,0.3);display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;overflow:hidden;animation:fadeInRight 0.8s ease-out;}
.risk-panel.high-risk{background:linear-gradient(135deg,#ff6b6b 0%,#ee5a6f 100%);color:white;}
.risk-panel.moderate-risk{background:linear-gradient(135deg,#ffd93d 0%,#f5af19 100%);color:white;}
.risk-panel.low-risk{background:linear-gradient(135deg,#6bcf7f 0%,#2ecc71 100%);color:white;}
.risk-panel.very-low-risk{background:linear-gradient(135deg,#a8e6cf 0%,#56ab2f 100%);color:white;}
.risk-panel.very-high-risk{background:linear-gradient(135deg,#ff9a00 0%,#ff3f00 100%);color:white;}
.risk-panel.extreme-risk{background:linear-gradient(135deg,#d00000 0%,#800000 100%);color:white;}
.risk-panel.empty{background:linear-gradient(135deg,#e9ecef 0%,#dee2e6 100%);color:#666;}
.risk-icon{font-size:100px;margin-bottom:25px;animation:bounce 1s infinite;}
.risk-title{font-size:2.8em;font-weight:700;margin-bottom:15px;text-shadow:2px 2px 4px rgba(0,0,0,0.2);}
.risk-fwi{font-size:2.5em;font-weight:600;margin-bottom:10px;}
.risk-meta{font-size:1.1em;opacity:0.95;margin-bottom:25px;}
.risk-description{font-size:1.05em;text-align:center;line-height:1.7;opacity:0.9;}
.stats-panel{grid-column:1 / -1;background:rgba(255,255,255,0.95);border-radius:20px;padding:30px;box-shadow:0 20px 60px rgba(0,0,0,0.3);margin-top:30px;}
.stats-panel h3{color:#333;margin-bottom:20px;font-size:1.3em;}
.stats-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;}
.stat-item{text-align:center;padding:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:10px;color:white;}
.stat-number{font-size:2.5em;font-weight:700;margin-bottom:5px;}
.stat-label{font-size:0.95em;opacity:0.9;}
.error{background:#ff6b6b;color:white;padding:15px;border-radius:10px;margin-bottom:20px;text-align:center;display:none;}
@keyframes fadeInDown{from{opacity:0;transform:translateY(-30px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeInLeft{from{opacity:0;transform:translateX(-30px);}to{opacity:1;transform:translateX(0);}}
@keyframes fadeInRight{from{opacity:0;transform:translateX(30px);}to{opacity:1;transform:translateX(0);}}
@keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-20px);}}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}
@keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);}}
.risk-panel.high-risk .risk-icon{animation:shake 0.5s infinite,bounce 1s infinite;}
@media(max-width:1024px){.main-content{grid-template-columns:1fr;}.feature-grid{grid-template-columns:1fr;}}
::-webkit-scrollbar{width:8px;}
::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px;}
::-webkit-scrollbar-thumb{background:#667eea;border-radius:10px;}
::-webkit-scrollbar-thumb:hover{background:#764ba2;}
</style>
</head>
<body>
<div class="header">
<h1><span class="logo-emoji">üî•</span>Fire Weather Index Predictor</h1>
<p>Real-time fire risk assessment based on weather conditions & forest metrics</p>
</div>

<div class="main-content">
<div class="input-panel">
<h2>üìä Enter Weather & Forest Data</h2>

<div class="section-title">üìç Location & Date</div>
<div class="input-group">
<label>Region</label>
<div class="region-buttons">
<button class="region-btn" data-region="1">üß≠ North</button>
<button class="region-btn" data-region="2">üß≠ South</button>
<button class="region-btn" data-region="0">üß≠ East</button>
<button class="region-btn" data-region="3">üß≠ West</button>
</div>
</div>

<div class="input-group"><label>Year</label><select id="year"></select></div>
<div class="input-group"><label>Month</label><select id="month"></select></div>
<div class="input-group"><label>Day</label><select id="day"></select></div>

<div class="section-title">üå°Ô∏è Weather Conditions</div>
<div class="input-group"><label>Temperature (¬∞C)</label><input type="number" id="temperature" step="0.1" placeholder="e.g., 28.5"><small id="temperature-range"></small></div>
<div class="input-group"><label>Relative Humidity (RH) %</label><input type="number" id="rh" step="0.1" placeholder="e.g., 52"><small id="rh-range"></small></div>
<div class="input-group"><label>Wind Speed (Ws) km/h</label><input type="number" id="ws" step="0.1" placeholder="e.g., 16"><small id="ws-range"></small></div>
<div class="input-group"><label>Rainfall (Rain) mm</label><input type="number" id="rain" step="0.1" placeholder="e.g., 0.3"><small id="rain-range"></small></div>

<div class="section-title">üå≤ Forest Fire Weather Index (FFWI) Components</div>
<div class="feature-grid">
<div class="input-group"><label>FFMC</label><input type="number" id="ffmc" step="0.1" placeholder="e.g., 78.4"><small id="ffmc-range"></small></div>
<div class="input-group"><label>DMC</label><input type="number" id="dmc" step="0.1" placeholder="e.g., 12.5"><small id="dmc-range"></small></div>
<div class="input-group"><label>DC</label><input type="number" id="dc" step="0.1" placeholder="e.g., 66.1"><small id="dc-range"></small></div>
<div class="input-group"><label>ISI</label><input type="number" id="isi" step="0.1" placeholder="e.g., 4.1"><small id="isi-range"></small></div>
<div class="input-group"><label>BUI</label><input type="number" id="bui" step="0.1" placeholder="e.g., 27.2"><small id="bui-range"></small></div>
</div>

<button class="predict-btn" id="predictBtn">üî• Predict Fire Risk</button>
<div id="error" class="error"></div>
</div>

<div class="risk-panel empty" id="riskPanel">
<div class="risk-icon">‚ùì</div>
<div class="risk-title">Ready to Predict</div>
<div class="risk-description">Enter location, date, and weather conditions to get fire risk prediction</div>
</div>
</div>

<div class="stats-panel">
<h3>üìä Statistics Dashboard</h3>
<div class="stats-content">
<div class="stat-item"><div class="stat-number" id="visitCount">0</div><div class="stat-label">Total Visits</div></div>
<div class="stat-item"><div class="stat-number" id="predictionCount">0</div><div class="stat-label">Predictions Made</div></div>
</div>
</div>

<script>
// --- JavaScript ---

let visitCounter = 0;
let predictionCounter = 0;

let selectedRegion = null;
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
const featureRanges = {
    temperature:{min:10,max:60}, rh:{min:10,max:100}, ws:{min:0,max:120}, rain:{min:0,max:200},
    ffmc:{min:0,max:100}, dmc:{min:0,max:150}, dc:{min:0,max:500}, isi:{min:0,max:50}, bui:{min:0,max:200}
};

// Display ranges
for(let f in featureRanges){
    let elem=document.getElementById(f+"-range");
    if(elem) elem.textContent=`Valid: ${featureRanges[f].min} - ${featureRanges[f].max}`;
}

// Populate dropdowns
const yearSelect=document.getElementById("year");
const monthSelect=document.getElementById("month");
const daySelect=document.getElementById("day");
const currentYear=new Date().getFullYear();
const years=Array.from({length:5},(_,i)=>currentYear-2+i);
populateSelect(yearSelect,years,"Select Year");
populateSelect(monthSelect,Array.from({length:12},(_,i)=>i+1),"Select Month");
daySelect.innerHTML="<option value=''>Select Day</option>";

function populateSelect(select,values,placeholder){
    select.innerHTML=`<option value=''>${placeholder}</option>`;
    values.forEach(v=>{
        let o=document.createElement("option");
        o.value=v;
        o.textContent=v;
        select.appendChild(o);
    });
}

function updateDays(){
    let y=parseInt(yearSelect.value); let m=parseInt(monthSelect.value);
    if(!y||!m){daySelect.innerHTML="<option value=''>Select Day</option>";return;}
    let days=(m==2)?(y%4===0&&(y%100!==0||y%400===0)?29:28):[4,6,9,11].includes(m)?30:31;
    populateSelect(daySelect,Array.from({length:days},(_,i)=>i+1),"Select Day");
}

yearSelect.addEventListener("change",updateDays);
monthSelect.addEventListener("change",updateDays);

// Region selection
document.querySelectorAll(".region-btn").forEach(btn=>{
    btn.addEventListener("click",function(){
        document.querySelectorAll(".region-btn").forEach(b=>b.classList.remove("active"));
        this.classList.add("active");
        selectedRegion=parseInt(this.dataset.region);
    });
});

// Error display
function showError(msg){
    const e=document.getElementById("error");
    e.textContent=msg;
    e.style.display="block";
}

// Determine risk based on genuine FWI thresholds
function getFWIRisk(fwi){
    if(fwi<5) return "Very Low Risk";
    if(fwi<12) return "Low Risk";
    if(fwi<25) return "Moderate Risk";
    if(fwi<50) return "High Risk";
    if(fwi<75) return "Very High Risk";
    return "Extreme Risk";
}

// Display risk panel
function displayRisk(d){
    const panel=document.getElementById("riskPanel");
    let rc=d.risk.toLowerCase().replace(" ","-");
    panel.className=`risk-panel ${rc}`;
    const icons={
        "very-low-risk":"üåø","low-risk":"üçÄ","moderate-risk":"‚ö†Ô∏è",
        "high-risk":"üî•","very-high-risk":"üî•üî•","extreme-risk":"üí•"
    };
    const descs={
        "very-low-risk":"Very low fire risk. Safe conditions.","low-risk":"Low fire risk. Stay alert.","moderate-risk":"Moderate fire risk. Exercise caution.",
        "high-risk":"High fire risk. Be careful.","very-high-risk":"Very high fire risk. Take precautions.","extreme-risk":"Extreme fire risk. Avoid fire activities."
    };
    panel.innerHTML=`<div class="risk-icon">${icons[rc]}</div>
    <div class="risk-title">${d.risk}</div>
    <div class="risk-fwi">FWI Index: ${d.fwi}</div>
    <div class="risk-meta">üìç ${d.region} | üìÖ ${d.date}</div>
    <div class="risk-description">${descs[rc]}</div>`;
}

// Sound feedback
function playSound(risk){
    let osc=audioContext.createOscillator();
    let gain=audioContext.createGain();
    osc.connect(gain);
    gain.connect(audioContext.destination);
    if(risk.includes("High")||risk.includes("Extreme")){
        osc.frequency.value=800; gain.gain.setValueAtTime(0.3,audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01,audioContext.currentTime+0.5);
    } else if(risk.includes("Moderate")){
        osc.frequency.value=500; gain.gain.setValueAtTime(0.15,audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01,audioContext.currentTime+0.3);
    } else{
        osc.frequency.value=400; gain.gain.setValueAtTime(0.05,audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01,audioContext.currentTime+0.2);
    }
    osc.start(audioContext.currentTime);
    osc.stop(audioContext.currentTime+0.5);
}

// Stats update

function updateStats(){
    visitCounter += 1;           // Page load count (or you can remove this line)
    predictionCounter += 1;      // Each prediction increments this

    document.getElementById("visitCount").textContent = visitCounter;
    document.getElementById("predictionCount").textContent = predictionCounter;
}


// Predict button
// --- Predict button ---
document.getElementById("predictBtn").addEventListener("click", function(){
    document.getElementById("error").style.display="none";

    // Check region
    if(selectedRegion===null || isNaN(selectedRegion)){
        showError("Select region");
        return;
    }

    // Get date values as integers
    let d = parseInt(daySelect.value);
    let m = parseInt(monthSelect.value);
    let y = parseInt(yearSelect.value);
    if(isNaN(d) || isNaN(m) || isNaN(y)){
        showError("Complete date required");
        return;
    }

    // Get feature values
    let features = ["temperature","rh","ws","rain","ffmc","dmc","dc","isi","bui"];
    let vals = {};
    for(let f of features){
        let elem = document.getElementById(f);
        if(!elem){
            showError(f + " input missing");
            return;
        }
        let v = parseFloat(elem.value);
        if(isNaN(v)){
            showError("Enter valid number for " + f);
            return;
        }
        vals[f] = v;
    }

    // Prepare payload matching app.py order
    let payload = {
        day: d,
        month: m,
        year: y,
        temperature: vals.temperature,
        rh: vals.rh,
        ws: vals.ws,
        rain: vals.rain,
        ffmc: vals.ffmc,
        dmc: vals.dmc,
        dc: vals.dc,
        isi: vals.isi,
        bui: vals.bui,
        region: parseInt(selectedRegion)
    };

    // Send request
    fetch("/predict", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(data => {
        if(data.error){
            showError(data.error);
            return;
        }
        displayRisk({
            risk: data.risk,
            fwi: data.fwi,
            region: ["East","North","South","West"][selectedRegion],
            date: `${y}-${m}-${d}`
        });
        playSound(data.risk);
        updateStats();
    })
    .catch(err => showError("Server error: "+err));
});

</script>


</body>
</html>